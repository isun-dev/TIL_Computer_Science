# 3강. 셸 사용하기

### 참고: UNIX시스템, 김진욱, 김희천 공저 | 한국방송통신대학교출판문화원

# 셸 개요

## 셸

### 명령어 해석기 또는 명령 행 인터페이스

- 사용자와 커널 사이에서 명령어를 해석하여 처리
- 셸 명령을 사용하면 GUI로는 하기 힘든 다양한 기능을 수행할 수 있음

### 셸 명령을 프로그램으로 작성하여 처리할 수도 있음

- 셸 스크립트는 텍스트 파일로, 프로그래밍을 통한 셸 명령어의 조합
- 반복적으로 수행되는 작업을 셸 스크립트로 작성할 수 있음
- 셸이 쉡 스크립트 파일을 읽어 처리할 수 있음

### 로그인을 하면 기본 셸이 주어짐

## 셸 사용하기

- 터미널에서 로그인을 해야 함.
- GNOME 데스크톱에서 셸을 사용함
- 프로그램>시스템도구>터미널
    - 여러 터미널 창을 띄워 사용할 수 있음
    - 셸을 명령 프롬프트와 명령 행을 제공함.
        - 기본적으로 일반 USER은 $모양으로 되어 있고, ROOT 계정은 #으로 되어 있다.

- 기본적으로 한 라인에 명령을 입력하고 Enter를 쳐 명령을 수행함.
    - 결과가 출력되면 명령 프롬프트가 다시 등장함.
    - 세미콜론(;)을 사용하면 한 라인에 여러 명령을 입력할 수 있음.

## 셸의 종류

### 많은 리눅스 배포판에서 bash를 기본 셸로 사용함

- 터미널을 띄우면 bash 셸이 사용자 명령을 기다린다.
- 명령을 입력할 수 있는 라인 == 명령 행
- 명령의 대기 중 == 프롬프트
- bash 셸의 경우 기본 프롬프트는 $이며, 루트 사용자의 경우에는 #이다.

### 셸의 종류에 따라 에일이어스 설정, 초기화 파일, 스크립트 작성, 명령 행 완성 기능, 명령 행 편집 기능 등에 차이가 있다.

### 실행 명령은 /bin/bash이다.

## 셸 선택하기

### 기본 셸을 변경할 수 있음

- chsh -s /bin/tcsh

### 터미널 창은 대화형 셸임

- 셸을 종료하려면 exit 명령 또는 ctrl + d를 실행

### 로그인 셸과 비로그인 셸을 구별해야 함.

- logout 명령은 로그인 셸에서만 가능
- 참고로 ctrl + alt + f2~6으로 가상 콘솔을 사용할 수 있음
- 셸 프롬프트에서 셸 프로그램을 실행하면 '서브 셸'이 실행됨.

# 셸 명령

## 셸 명령의 형식과 실행

`$명령어 옵션 인수`

- 예: usermod -L test
- 옵션과 인수는 여럿일 수 있으며 선택적 또는 필수적

### 명령어는 프로그램의 이름

### 가장 간단한 형태의 실행은 명령의 이름만 사용

- who, date, ls, pwd

### chsh 명령

- 기본 셸을 바꾸는 명령
- chsh [options] [username]
    - 대괄호는 생략 가능, 이탤릭체는 적당한 내용으로 대체
    - 복수는 여러 개가 가능하다는 의미

## 옵션과 인수

### 짧은 옵션(-) ⇒ 유닉스 스타일임

- ls -l
- ls -lat와 ls -l -a -t는 같은 것

### 긴 옵션(--) ⇒ GNU 스타일

- `ls --all`

### 인수는 명령의 수행 대상을 지정하는 것

cat -n /etc/passwd(n옵션은 라인수를 표시해준다)

grep "test" /etc/passwd  ⇒ /etc/passwd 에서 test를 찾아라.

### 옵션도 인수를 가질 수 있음.

- chsh -s /bin/sh test
- `chsh --shell=/bin/bash test`(옵션에 인수가 필요한 필요한 경우에는 =을 사용한다.) ⇒ 그리고 중요한 것은 옵션과 인수 사이에는 빈칸이 있으면 안된다.

## 명령어의 종류

### 일반 명령에서 필수적으로 알고 있어야 하는 내용!!!

- 환경변수 PATH에 설정된 경로 중에 실행 파일이 존재하면 이름만으로 실행이 가능
    - 아니면 절대 경로를 사용해야 함.
    - 현재 디렉토리(.)은 보통 PATH에 포함되어 있지 않음
    - `echo $PATH` 로 저장된 경로를 확인할 수 있음. ⇒ PATH 환경 변수에 저장된 경로...!!

### 명령어 뜻과 사용법을 확인하는 방법

- 일반 명령
    - 명령어 --help
- 내장 명령
    - help 명령어

### alias 명령

- 자주 사용되는 명령의 단축 명령을 만드는 명령
    - alias ⇒ 단축 명령 리스트를 확인할 수 있음
    - alias la='ls -A' ⇒ la는 ls -A의 단축 명령
    - alias rm='rm -i'
- 계속 유지하려면 셸의 환경 설정 파일에 기록해 두어야 함(리눅스 실행 시 로딩 되는 파일 내)

### type 명령

- 명령이 어떻게 해석되는지 알려주는 명령
    - type cd

    - type -a ls  ⇒ a 옵션은 모든 내용을 다 출력해준다.

### which 명령

- 실행 프로그램을 `환경변수 PATH를 기초로` 찾아 경로를 출력함
    - which rm ⇒ 현재 사용하고 있는 명령어 실행 파일(또는 링크)의 위치를 알 수 있다.
    - 이와 비슷한 걸로 whereis rm이 있음 ⇒ 바이너리 파일의 위치뿐만 아니라, 소스, 매뉴얼의 위치도 알 수 있다.

### man 명령

- 매뉴얼 페이지를 보여줌
    - 명령의 사용법이나 설정 파일 등에 관한 온라인 도움말을 제공
    - man passwd 또는 man 5 passwd
    - 명령어의 간단한 도움말을 볼려면 명령 --help를 사용할 수 있음



# 명령 히스토리

### history 명령

- 이전에 수행했던 명령 행의 목록을 불러옴
    - history 또는 history 10  ⇒ 그냥 history는 디폴트로 1000개가 나옴

### 히스토리 기능을 이용하여 명령을 실행하는 방법

- 이전에 수행했던 명령을 이용하여 명령을 수행할 수 있음
- 다음을 입력하고 실행함
    - 명령 행 편집도 가능


### 명령행 완성 기능 ⇒ tab키로 할 수 있음



# 명령의 연결과 확장

## 특수 문자

### 셸에서 특별한 의미를 가지는 문자



## 파이프

0은 표준입력, 1은 표준출력, 2는 표준오류출력

- 앞 명령의 출력 결과를 다음 명령의 입력으로 연결
    - 명령을 입력할 때, 표준입력(키보드)로부터 읽어 들이지 않고 파일로부터 입력을 얻을 수 있다. 이때 왼쪽 화살 괄호(<)를 사용하는데 이것은 표준입력을 지정된 파일로 리다이렉션하는 기능을 제공하는 특수 문자 이다.
        - 예를 들어, sort < /etc/passwd를 수행하면 표준 입력 대신 지정된 /etc/passwd를 읽어 정렬한 후 화면에 출력한다.

```bash
명령1 | 명령2
cat /etc/passwd | sort | more

```

## 입출력 리다이렉션

### 명령 수행에 필요한 표준 입력 대신에 파일로부터 얻음

- 명령 < 파일
    - sort < /etc/passwd

### 명령 수행의 결과를 표준 출력으로 보내지 않고 파일에 기록함.

- 명령 > 파일

```bash
grep typedef /usr/include/* > typedef.out
지정된 위치 /usr/include/에 있는 모든 파일에서 문자열 typedef를 포함하는 라인을 찾아서 typedef.out에
기록한다.
```

### 명령 수행 중 표준 오류 출력을 파일에 덧붙임

- 명령 2> error.txt

## 명령 치환

- 명령을 수행할 때, 명령의 인수로서 다른 명령의 결과를 사용
- $(command) 또는 `command`
    - 역따옴표(` `)를 사용함
        - 해석: which passwd를 실행해서 나온 결과를 ls -l의 인수로 사용한다.


## 인용 부호

- 빈칸을 포함하는 문자열을 1개의 인수로 사용할 때 인용부호가 필요함
    - echo I AM A BOY를 하게 되면 빈칸이 포함되기 때문에 한개의 인수로 보는게 아니라 4개의 인수로 본다. 이를 하나의 인수로 사용할려면
    - echo 'I AM A BOY'로 사용을 한다.
- 작은 따옴표('')는 특수 문자의 의미를 제거함, 아래처럼 그대로 출력을 함.



- 큰 따옴표는("")는 $, ``, \, !를 해석하여 확장함.


## 수식과 변수의 확장

- 수식의 결과를 명령 수행 전에 전달
    - $[수식] 또는 $((수식))
- 변수의 값을 추출하여 명령 수행전에 전달
    - $변수

# 셸 변수

## 셸 변수와 환경변수

### 셸 변수는 셸의 환경을 설정하기 위한 값을 저장

- 모든 변수와 값을 출력하기 위해 set 명령을 사용

### 셸 변수 == 지역변수

- 현재 셸에서만 사용이 가능하고 서브 셸로는 전달되지 않음(지역변수)

### 환경 변수 == 전역변수

- 현재 셸뿐만 아니라 서브 셸로도 전달(전역변수)
- 보통 변수 이름으로 대문자를 사용한다.
- 터미널 창을 열어 쉘을 시작하면 이미 많은 환경 변수가 설정되어 있음.
- 모든 환경 변수와 값을 출력하기 위해 printenv 명령을 사용.

### 변수 설정과 환경 변수로 만드는 방법

- 변수=값    ⇒ 변수 설정
- export 변수 ⇒ 환경 변수를 만드는 명령어

### 특정 환경 변수의 값을 확인하는 방법

1. printenv 변수
2. echo $변수 는 모든 종류의 변수 값을 확인할 수 있음

```bash
$ FOO=bar   => 여기는 절대로 띄어쓰면 안됨.
$ export FOO  => FOO라는 환경변수가 만들어짐
$ sh  => 서브 쉘로 들어감, 환경변수는 서브쉘에서도 실행이 되기 때문에 확인을 위해 실행
sh-4.1$ echo $FOO
bar
sh-4.1$ printenv FOO
bar
sh-4.1$ exit   => 쉘 나오기
$ unset FOO   => 변수 unset
```

### 로그인과 셸의 환경 설정 파일

- 로그인을 할 때 또는 셸을 시작할 때 자동으로 실행되는 명령을 저장한 파일
    - 시스템 환경 설정 파일과 사용자 환경 설정 파일이 있음
    - 셸의 종류에 따라 다른 이름의 파일을 사용함.
    - bash 셸의 경우 다음과 같음.